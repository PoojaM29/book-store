function cov_p713qmk2x(){var path="C:\\Pooja\\Order Booking\\Backend\\controllers\\cart.js";var hash="5ce15c0a65d7991f99e98af3a2399fc27c9758ef";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Pooja\\Order Booking\\Backend\\controllers\\cart.js",statementMap:{"0":{start:{line:1,column:13},end:{line:1,column:46}},"1":{start:{line:2,column:13},end:{line:2,column:46}},"2":{start:{line:3,column:16},end:{line:3,column:52}},"3":{start:{line:4,column:13},end:{line:4,column:46}},"4":{start:{line:6,column:0},end:{line:145,column:2}},"5":{start:{line:8,column:21},end:{line:8,column:32}},"6":{start:{line:9,column:8},end:{line:14,column:11}},"7":{start:{line:10,column:12},end:{line:13,column:15}},"8":{start:{line:18,column:21},end:{line:18,column:32}},"9":{start:{line:20,column:8},end:{line:27,column:15}},"10":{start:{line:23,column:16},end:{line:26,column:19}},"11":{start:{line:31,column:21},end:{line:31,column:32}},"12":{start:{line:32,column:21},end:{line:32,column:38}},"13":{start:{line:34,column:8},end:{line:68,column:11}},"14":{start:{line:35,column:12},end:{line:39,column:13}},"15":{start:{line:36,column:16},end:{line:38,column:19}},"16":{start:{line:41,column:12},end:{line:62,column:15}},"17":{start:{line:42,column:30},end:{line:42,column:32}},"18":{start:{line:44,column:16},end:{line:46,column:17}},"19":{start:{line:45,column:20},end:{line:45,column:47}},"20":{start:{line:48,column:16},end:{line:52,column:17}},"21":{start:{line:49,column:20},end:{line:51,column:23}},"22":{start:{line:54,column:16},end:{line:54,column:40}},"23":{start:{line:55,column:16},end:{line:55,column:46}},"24":{start:{line:56,column:16},end:{line:56,column:28}},"25":{start:{line:58,column:16},end:{line:61,column:19}},"26":{start:{line:64,column:12},end:{line:64,column:29}},"27":{start:{line:65,column:12},end:{line:67,column:15}},"28":{start:{line:72,column:21},end:{line:72,column:32}},"29":{start:{line:73,column:21},end:{line:73,column:38}},"30":{start:{line:75,column:8},end:{line:99,column:11}},"31":{start:{line:76,column:12},end:{line:80,column:13}},"32":{start:{line:77,column:16},end:{line:79,column:19}},"33":{start:{line:82,column:12},end:{line:93,column:15}},"34":{start:{line:83,column:16},end:{line:85,column:47}},"35":{start:{line:84,column:30},end:{line:84,column:42}},"36":{start:{line:85,column:33},end:{line:85,column:45}},"37":{start:{line:86,column:16},end:{line:86,column:46}},"38":{start:{line:87,column:16},end:{line:87,column:28}},"39":{start:{line:89,column:16},end:{line:92,column:19}},"40":{start:{line:95,column:12},end:{line:95,column:29}},"41":{start:{line:96,column:12},end:{line:98,column:15}},"42":{start:{line:103,column:21},end:{line:103,column:32}},"43":{start:{line:104,column:25},end:{line:104,column:26}},"44":{start:{line:105,column:23},end:{line:105,column:25}},"45":{start:{line:107,column:8},end:{line:143,column:15}},"46":{start:{line:111,column:16},end:{line:121,column:17}},"47":{start:{line:112,column:20},end:{line:112,column:77}},"48":{start:{line:113,column:20},end:{line:120,column:23}},"49":{start:{line:123,column:16},end:{line:142,column:19}},"50":{start:{line:128,column:20},end:{line:136,column:23}},"51":{start:{line:129,column:24},end:{line:129,column:40}},"52":{start:{line:130,column:24},end:{line:130,column:44}},"53":{start:{line:131,column:24},end:{line:131,column:36}},"54":{start:{line:132,column:24},end:{line:135,column:27}},"55":{start:{line:138,column:20},end:{line:138,column:37}},"56":{start:{line:139,column:20},end:{line:141,column:23}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:17},end:{line:7,column:18}},loc:{start:{line:7,column:31},end:{line:15,column:5}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:44},end:{line:9,column:45}},loc:{start:{line:9,column:54},end:{line:14,column:9}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:17,column:13},end:{line:17,column:14}},loc:{start:{line:17,column:27},end:{line:28,column:5}},line:17},"3":{name:"(anonymous_3)",decl:{start:{line:22,column:18},end:{line:22,column:19}},loc:{start:{line:22,column:28},end:{line:27,column:13}},line:22},"4":{name:"(anonymous_4)",decl:{start:{line:30,column:15},end:{line:30,column:16}},loc:{start:{line:30,column:29},end:{line:69,column:5}},line:30},"5":{name:"(anonymous_5)",decl:{start:{line:34,column:35},end:{line:34,column:36}},loc:{start:{line:34,column:45},end:{line:63,column:9}},line:34},"6":{name:"(anonymous_6)",decl:{start:{line:41,column:48},end:{line:41,column:49}},loc:{start:{line:41,column:58},end:{line:62,column:13}},line:41},"7":{name:"(anonymous_7)",decl:{start:{line:63,column:17},end:{line:63,column:18}},loc:{start:{line:63,column:26},end:{line:68,column:9}},line:63},"8":{name:"(anonymous_8)",decl:{start:{line:71,column:20},end:{line:71,column:21}},loc:{start:{line:71,column:34},end:{line:100,column:5}},line:71},"9":{name:"(anonymous_9)",decl:{start:{line:75,column:35},end:{line:75,column:36}},loc:{start:{line:75,column:45},end:{line:94,column:9}},line:75},"10":{name:"(anonymous_10)",decl:{start:{line:82,column:48},end:{line:82,column:49}},loc:{start:{line:82,column:58},end:{line:93,column:13}},line:82},"11":{name:"(anonymous_11)",decl:{start:{line:84,column:25},end:{line:84,column:26}},loc:{start:{line:84,column:30},end:{line:84,column:42}},line:84},"12":{name:"(anonymous_12)",decl:{start:{line:85,column:28},end:{line:85,column:29}},loc:{start:{line:85,column:33},end:{line:85,column:45}},line:85},"13":{name:"(anonymous_13)",decl:{start:{line:94,column:17},end:{line:94,column:18}},loc:{start:{line:94,column:26},end:{line:99,column:9}},line:94},"14":{name:"(anonymous_14)",decl:{start:{line:102,column:14},end:{line:102,column:15}},loc:{start:{line:102,column:28},end:{line:144,column:5}},line:102},"15":{name:"(anonymous_15)",decl:{start:{line:110,column:18},end:{line:110,column:19}},loc:{start:{line:110,column:28},end:{line:143,column:13}},line:110},"16":{name:"(anonymous_16)",decl:{start:{line:127,column:24},end:{line:127,column:25}},loc:{start:{line:127,column:37},end:{line:137,column:17}},line:127},"17":{name:"(anonymous_17)",decl:{start:{line:128,column:92},end:{line:128,column:93}},loc:{start:{line:128,column:98},end:{line:136,column:21}},line:128},"18":{name:"(anonymous_18)",decl:{start:{line:137,column:25},end:{line:137,column:26}},loc:{start:{line:137,column:34},end:{line:142,column:17}},line:137}},branchMap:{"0":{loc:{start:{line:35,column:12},end:{line:39,column:13}},type:"if",locations:[{start:{line:35,column:12},end:{line:39,column:13}},{start:{line:35,column:12},end:{line:39,column:13}}],line:35},"1":{loc:{start:{line:48,column:16},end:{line:52,column:17}},type:"if",locations:[{start:{line:48,column:16},end:{line:52,column:17}},{start:{line:48,column:16},end:{line:52,column:17}}],line:48},"2":{loc:{start:{line:76,column:12},end:{line:80,column:13}},type:"if",locations:[{start:{line:76,column:12},end:{line:80,column:13}},{start:{line:76,column:12},end:{line:80,column:13}}],line:76}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"5ce15c0a65d7991f99e98af3a2399fc27c9758ef"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_p713qmk2x=function(){return actualCoverage;};}return actualCoverage;}cov_p713qmk2x();const CART=(cov_p713qmk2x().s[0]++,require('mongoose').model('Cart'));const BOOK=(cov_p713qmk2x().s[1]++,require('mongoose').model('Book'));const RECEIPT=(cov_p713qmk2x().s[2]++,require('mongoose').model('Receipt'));const USER=(cov_p713qmk2x().s[3]++,require('mongoose').model('User'));cov_p713qmk2x().s[4]++;module.exports={getCartSize:(req,res)=>{cov_p713qmk2x().f[0]++;let userId=(cov_p713qmk2x().s[5]++,req.user.id);cov_p713qmk2x().s[6]++;CART.findOne({user:userId}).then(cart=>{cov_p713qmk2x().f[1]++;cov_p713qmk2x().s[7]++;res.status(200).json({message:'',data:cart.books.length});});},getCart:(req,res)=>{cov_p713qmk2x().f[2]++;let userId=(cov_p713qmk2x().s[8]++,req.user.id);cov_p713qmk2x().s[9]++;CART.findOne({user:userId}).populate('books').then(cart=>{cov_p713qmk2x().f[3]++;cov_p713qmk2x().s[10]++;res.status(200).json({message:'',data:cart});});},addToCart:(req,res)=>{cov_p713qmk2x().f[4]++;let userId=(cov_p713qmk2x().s[11]++,req.user.id);let bookId=(cov_p713qmk2x().s[12]++,req.params.bookId);cov_p713qmk2x().s[13]++;BOOK.findById(bookId).then(book=>{cov_p713qmk2x().f[5]++;cov_p713qmk2x().s[14]++;if(!book){cov_p713qmk2x().b[0][0]++;cov_p713qmk2x().s[15]++;return res.status(400).json({message:'There is no book with the given id in our database.'});}else{cov_p713qmk2x().b[0][1]++;}cov_p713qmk2x().s[16]++;CART.findOne({user:userId}).then(cart=>{cov_p713qmk2x().f[6]++;let bookIds=(cov_p713qmk2x().s[17]++,[]);cov_p713qmk2x().s[18]++;for(let b of cart.books){cov_p713qmk2x().s[19]++;bookIds.push(b.toString());}cov_p713qmk2x().s[20]++;if(bookIds.indexOf(bookId)!==-1){cov_p713qmk2x().b[1][0]++;cov_p713qmk2x().s[21]++;return res.status(400).json({message:'Book is already in your cart'});}else{cov_p713qmk2x().b[1][1]++;}cov_p713qmk2x().s[22]++;cart.books.push(bookId);cov_p713qmk2x().s[23]++;cart.totalPrice+=book.price;cov_p713qmk2x().s[24]++;cart.save();cov_p713qmk2x().s[25]++;res.status(200).json({message:'Book added to cart!',data:cart});});}).catch(err=>{cov_p713qmk2x().f[7]++;cov_p713qmk2x().s[26]++;console.log(err);cov_p713qmk2x().s[27]++;return res.status(400).json({message:'Something went wrong, please try again.'});});},removeFromCart:(req,res)=>{cov_p713qmk2x().f[8]++;let userId=(cov_p713qmk2x().s[28]++,req.user.id);let bookId=(cov_p713qmk2x().s[29]++,req.params.bookId);cov_p713qmk2x().s[30]++;BOOK.findById(bookId).then(book=>{cov_p713qmk2x().f[9]++;cov_p713qmk2x().s[31]++;if(!book){cov_p713qmk2x().b[2][0]++;cov_p713qmk2x().s[32]++;return res.status(400).json({message:'There is no book with the given id in our database.'});}else{cov_p713qmk2x().b[2][1]++;}cov_p713qmk2x().s[33]++;CART.findOne({user:userId}).then(cart=>{cov_p713qmk2x().f[10]++;cov_p713qmk2x().s[34]++;cart.books=cart.books.map(b=>{cov_p713qmk2x().f[11]++;cov_p713qmk2x().s[35]++;return b.toString();}).filter(b=>{cov_p713qmk2x().f[12]++;cov_p713qmk2x().s[36]++;return b!==bookId;});cov_p713qmk2x().s[37]++;cart.totalPrice-=book.price;cov_p713qmk2x().s[38]++;cart.save();cov_p713qmk2x().s[39]++;res.status(200).json({message:'Book removed from cart!',data:cart});});}).catch(err=>{cov_p713qmk2x().f[13]++;cov_p713qmk2x().s[40]++;console.log(err);cov_p713qmk2x().s[41]++;return res.status(400).json({message:'Something went wrong, please try again.'});});},checkout:(req,res)=>{cov_p713qmk2x().f[14]++;let userId=(cov_p713qmk2x().s[42]++,req.user.id);let totalPrice=(cov_p713qmk2x().s[43]++,0);let products=(cov_p713qmk2x().s[44]++,[]);cov_p713qmk2x().s[45]++;CART.findOne({user:userId}).populate('books').then(cart=>{cov_p713qmk2x().f[15]++;cov_p713qmk2x().s[46]++;for(let book of cart.books){cov_p713qmk2x().s[47]++;totalPrice+=book.price*req.body[book._id.toString()];cov_p713qmk2x().s[48]++;products.push({id:book._id,title:book.title,author:book.author,cover:book.cover,price:book.price,qty:req.body[book._id.toString()]});}cov_p713qmk2x().s[49]++;RECEIPT.create({user:userId,productsInfo:products,totalPrice:totalPrice}).then(receipt=>{cov_p713qmk2x().f[16]++;cov_p713qmk2x().s[50]++;USER.update({_id:userId},{$push:{receipts:receipt._id}}).then(()=>{cov_p713qmk2x().f[17]++;cov_p713qmk2x().s[51]++;cart.books=[];cov_p713qmk2x().s[52]++;cart.totalPrice=0;cov_p713qmk2x().s[53]++;cart.save();cov_p713qmk2x().s[54]++;return res.status(200).json({message:'Thank you for your order! Books will be sent to you as soon as possible!',data:receipt});});}).catch(err=>{cov_p713qmk2x().f[18]++;cov_p713qmk2x().s[55]++;console.log(err);cov_p713qmk2x().s[56]++;return res.status(400).json({message:'Something went wrong, please try again.'});});});}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDQVJUIiwicmVxdWlyZSIsIm1vZGVsIiwiQk9PSyIsIlJFQ0VJUFQiLCJVU0VSIiwibW9kdWxlIiwiZXhwb3J0cyIsImdldENhcnRTaXplIiwicmVxIiwicmVzIiwidXNlcklkIiwidXNlciIsImlkIiwiZmluZE9uZSIsInRoZW4iLCJjYXJ0Iiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJkYXRhIiwiYm9va3MiLCJsZW5ndGgiLCJnZXRDYXJ0IiwicG9wdWxhdGUiLCJhZGRUb0NhcnQiLCJib29rSWQiLCJwYXJhbXMiLCJmaW5kQnlJZCIsImJvb2siLCJib29rSWRzIiwiYiIsInB1c2giLCJ0b1N0cmluZyIsImluZGV4T2YiLCJ0b3RhbFByaWNlIiwicHJpY2UiLCJzYXZlIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwicmVtb3ZlRnJvbUNhcnQiLCJtYXAiLCJmaWx0ZXIiLCJjaGVja291dCIsInByb2R1Y3RzIiwiYm9keSIsIl9pZCIsInRpdGxlIiwiYXV0aG9yIiwiY292ZXIiLCJxdHkiLCJjcmVhdGUiLCJwcm9kdWN0c0luZm8iLCJyZWNlaXB0IiwidXBkYXRlIiwiJHB1c2giLCJyZWNlaXB0cyJdLCJzb3VyY2VzIjpbImNhcnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQ0FSVCA9IHJlcXVpcmUoJ21vbmdvb3NlJykubW9kZWwoJ0NhcnQnKTtcclxuY29uc3QgQk9PSyA9IHJlcXVpcmUoJ21vbmdvb3NlJykubW9kZWwoJ0Jvb2snKTtcclxuY29uc3QgUkVDRUlQVCA9IHJlcXVpcmUoJ21vbmdvb3NlJykubW9kZWwoJ1JlY2VpcHQnKTtcclxuY29uc3QgVVNFUiA9IHJlcXVpcmUoJ21vbmdvb3NlJykubW9kZWwoJ1VzZXInKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gICAgZ2V0Q2FydFNpemU6IChyZXEsIHJlcykgPT4ge1xyXG4gICAgICAgIGxldCB1c2VySWQgPSByZXEudXNlci5pZDtcclxuICAgICAgICBDQVJULmZpbmRPbmUoeyB1c2VyOiB1c2VySWQgfSkudGhlbigoY2FydCkgPT4ge1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnJyxcclxuICAgICAgICAgICAgICAgIGRhdGE6IGNhcnQuYm9va3MubGVuZ3RoXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICBnZXRDYXJ0OiAocmVxLCByZXMpID0+IHtcclxuICAgICAgICBsZXQgdXNlcklkID0gcmVxLnVzZXIuaWQ7XHJcblxyXG4gICAgICAgIENBUlQuZmluZE9uZSh7IHVzZXI6IHVzZXJJZCB9KVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ2Jvb2tzJylcclxuICAgICAgICAgICAgLnRoZW4oKGNhcnQpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBjYXJ0XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGFkZFRvQ2FydDogKHJlcSwgcmVzKSA9PiB7XHJcbiAgICAgICAgbGV0IHVzZXJJZCA9IHJlcS51c2VyLmlkO1xyXG4gICAgICAgIGxldCBib29rSWQgPSByZXEucGFyYW1zLmJvb2tJZDtcclxuXHJcbiAgICAgICAgQk9PSy5maW5kQnlJZChib29rSWQpLnRoZW4oKGJvb2spID0+IHtcclxuICAgICAgICAgICAgaWYgKCFib29rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGVyZSBpcyBubyBib29rIHdpdGggdGhlIGdpdmVuIGlkIGluIG91ciBkYXRhYmFzZS4nXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgQ0FSVC5maW5kT25lKHsgdXNlcjogdXNlcklkIH0pLnRoZW4oKGNhcnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBib29rSWRzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgYiBvZiBjYXJ0LmJvb2tzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9va0lkcy5wdXNoKGIudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGJvb2tJZHMuaW5kZXhPZihib29rSWQpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdCb29rIGlzIGFscmVhZHkgaW4geW91ciBjYXJ0J1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNhcnQuYm9va3MucHVzaChib29rSWQpO1xyXG4gICAgICAgICAgICAgICAgY2FydC50b3RhbFByaWNlICs9IGJvb2sucHJpY2U7XHJcbiAgICAgICAgICAgICAgICBjYXJ0LnNhdmUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0Jvb2sgYWRkZWQgdG8gY2FydCEnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGNhcnRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4uJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgcmVtb3ZlRnJvbUNhcnQ6IChyZXEsIHJlcykgPT4ge1xyXG4gICAgICAgIGxldCB1c2VySWQgPSByZXEudXNlci5pZDtcclxuICAgICAgICBsZXQgYm9va0lkID0gcmVxLnBhcmFtcy5ib29rSWQ7XHJcblxyXG4gICAgICAgIEJPT0suZmluZEJ5SWQoYm9va0lkKS50aGVuKChib29rKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghYm9vaykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVGhlcmUgaXMgbm8gYm9vayB3aXRoIHRoZSBnaXZlbiBpZCBpbiBvdXIgZGF0YWJhc2UuJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIENBUlQuZmluZE9uZSh7IHVzZXI6IHVzZXJJZCB9KS50aGVuKChjYXJ0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjYXJ0LmJvb2tzID0gY2FydC5ib29rc1xyXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoYiA9PiBiLnRvU3RyaW5nKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihiID0+IGIgIT09IGJvb2tJZCk7XHJcbiAgICAgICAgICAgICAgICBjYXJ0LnRvdGFsUHJpY2UgLT0gYm9vay5wcmljZTtcclxuICAgICAgICAgICAgICAgIGNhcnQuc2F2ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnQm9vayByZW1vdmVkIGZyb20gY2FydCEnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGNhcnRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4uJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgY2hlY2tvdXQ6IChyZXEsIHJlcykgPT4ge1xyXG4gICAgICAgIGxldCB1c2VySWQgPSByZXEudXNlci5pZDtcclxuICAgICAgICBsZXQgdG90YWxQcmljZSA9IDA7XHJcbiAgICAgICAgbGV0IHByb2R1Y3RzID0gW107XHJcblxyXG4gICAgICAgIENBUlRcclxuICAgICAgICAgICAgLmZpbmRPbmUoeyB1c2VyOiB1c2VySWQgfSlcclxuICAgICAgICAgICAgLnBvcHVsYXRlKCdib29rcycpXHJcbiAgICAgICAgICAgIC50aGVuKChjYXJ0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBib29rIG9mIGNhcnQuYm9va3MpIHtcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbFByaWNlICs9IGJvb2sucHJpY2UgKiByZXEuYm9keVtib29rLl9pZC50b1N0cmluZygpXTtcclxuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGJvb2suX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogYm9vay50aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aG9yOiBib29rLmF1dGhvcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY292ZXI6IGJvb2suY292ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlOiBib29rLnByaWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBxdHk6IHJlcS5ib2R5W2Jvb2suX2lkLnRvU3RyaW5nKCldXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgUkVDRUlQVC5jcmVhdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHVzZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICBwcm9kdWN0c0luZm86IHByb2R1Y3RzLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsUHJpY2U6IHRvdGFsUHJpY2VcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlY2VpcHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBVU0VSLnVwZGF0ZSh7IF9pZDogdXNlcklkIH0sIHsgJHB1c2g6IHsgcmVjZWlwdHM6IHJlY2VpcHQuX2lkIH0gfSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhcnQuYm9va3MgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FydC50b3RhbFByaWNlID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FydC5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVGhhbmsgeW91IGZvciB5b3VyIG9yZGVyISBCb29rcyB3aWxsIGJlIHNlbnQgdG8geW91IGFzIHNvb24gYXMgcG9zc2libGUhJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlY2VpcHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4uJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG59OyJdLCJtYXBwaW5ncyI6IjBvUEFlWTtBQUFBLHlGQWZaLEtBQU1BLEtBQUkseUJBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQ0MsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUM5QyxLQUFNQyxLQUFJLHlCQUFHRixPQUFPLENBQUMsVUFBVSxDQUFDLENBQUNDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFDOUMsS0FBTUUsUUFBTyx5QkFBR0gsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDQyxLQUFLLENBQUMsU0FBUyxDQUFDLEVBQ3BELEtBQU1HLEtBQUkseUJBQUdKLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQ0MsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFDLHVCQUUvQ0ksTUFBTSxDQUFDQyxPQUFPLENBQUcsQ0FDYkMsV0FBVyxDQUFFLENBQUNDLEdBQUcsQ0FBRUMsR0FBRyxHQUFLLHdCQUN2QixHQUFJQyxPQUFNLHlCQUFHRixHQUFHLENBQUNHLElBQUksQ0FBQ0MsRUFBRSxFQUFDLHVCQUN6QmIsSUFBSSxDQUFDYyxPQUFPLENBQUMsQ0FBRUYsSUFBSSxDQUFFRCxNQUFPLENBQUMsQ0FBQyxDQUFDSSxJQUFJLENBQUVDLElBQUksRUFBSywrQ0FDMUNOLEdBQUcsQ0FBQ08sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FDakJDLE9BQU8sQ0FBRSxFQUFFLENBQ1hDLElBQUksQ0FBRUos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